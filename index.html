<html>
  <div id="head">
    <head style="text-align: center;">
      <h1> Tabulation </h1>
    </head>
  </div>

  <div id="body">
    <body style="text-align: center;">
      <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
      <button onclick="handleSignInClick()"> Press to sign in to verify access to Google Spreadsheets. </button>
      <br>
      <br>
      <div id='login'>
        <br>
        <h2> Set Up Spreadsheet for a Contest </h2>
        <button onclick="createNew()"> Create New Contest </button>
        <br>
        <br>
        <h2> Select a Contest to Judge </h1>
        <select id="contest-selection">
        </select>
        <br>
        <br>
        <button onclick="loadJudge()"> Continue </button>
        <br>
        <br>
      </div>
      <div id='judge-1'>
        <select id="div-selection">
        </select>
        <br>
        <br>
        <select id="judge-type">
          <option> Clicker </option>
          <option> Evaluation </option>
        </select>
        <br>
        <br>
        <button onclick="chooseJudge()"> View Judges </button>
        <br>
      </div>
      <div id='judge-2'>
        <br>
        <select id="judge-list">
        </select>
        <br>
        <br>
        <text> Which are you judging? </text>
        <br>
        <text> Prelim/Semi-final/Sport (4 evaluations) </text>
        <input type="checkbox" id="4">
        <br>
        <text> Final (8 evaluations) </text>
        <input type="checkbox" id="8">
        <br>
        <br>
        <button onclick="startJudging()"> Start Judging </button>
        <br>
      </div>
      <div id='contest-info'>
        <text> Input Contest Name </text>
        <br>
        <input id="contest-name"> </input>
        <br>
        <br>
        <text> Input Round </text>
        <br>
        <input id="round"> </input>
        <br>
        <br>
        <text> Input Division Name </text>
        <br>
        <input id="div-name"> </input>
        <br>
        <br>
        <text> Input Clicker Judges </text>
        <br>
        <textarea id="clicker-judges"></textarea>
        <br>
        <br>
        <text> Input Eval Judges </text>
        <br>
        <textarea id="eval-judges"></textarea>
        <br>
        <br>
        <text> Input Spreadsheet Link </text>
        <br>
        <input id="sheet-link">  </input>
        <br>
        <br>
        <button onclick="enterInfo()"> Submit </button>
        <br>
        <br>
      </div>
      <div id='player-info'>
        <text> Input Player List </text>
        <br>
        <textarea id="player-list"></textarea>
        <br>
        <br>
        <button onclick="enterPlayer()"> Submit </button>
      </div>
      <div id='click-input'>
        <text id="click-player-name">  </text>
        <br>
        <br>
        <text> Input Clicker Score </text>
        <br>
        <br>
        <text> Positive </text>
        <br>
        <input id="positive"> </input>
        <br>
        <br>
        <text> Negative </text>
        <br>
        <input id="negative"> </input>
        <br>
        <br>
        <text> Stop </text>
        <br>
        <input id="restart"> </input>
        <br>
        <br>
        <text> Discard </text>
        <br>
        <input id="discard"> </input>
        <br>
        <br>
        <text> Cut </text>
        <br>
        <input id="detach"> </input>
        <br>
        <br>
        <button onclick="storeClick(index)"> Submit </button>
        <br>
        <br>
        <table style="width:100%" id="click-table">
          <tr>
            <td style="width:40%"> Name </td>
            <td style="width:10%"> + </td>
            <td style="width:10%"> - </td>
            <td style="width:10%"> Stop </td>
            <td style="width:10%"> Discard </td>
            <td style="width:10%"> Cut </td>
            <td style="width:10%"> Edit </td>
        </table>
      </div>
      <div id='eval-final-input'>
        <text id="eval-player-name-final">  </text>
        <br>
        <br>
        <text> Input Eval Score </text>
        <br>
        <br>
        <text> Execution </text>
        <br>
        <input id="execution-f"> </input>
        <br>
        <br>
        <text> Control </text>
        <br>
        <input id="control-f"> </input>
        <br>
        <br>
        <text> Variation </text>
        <br>
        <input id="variation-f"> </input>
        <br>
        <br>
        <text> Space Use </text>
        <br>
        <input id="space-use-f"> </input>
        <br>
        <br>
        <text> Choreography </text>
        <br>
        <input id="choreography-f"> </input>
        <br>
        <br>
        <text> Construction </text>
        <br>
        <input id="construction-f"> </input>
        <br>
        <br>
        <text> Body Control </text>
        <br>
        <input id="body-control-f"> </input>
        <br>
        <br>
        <text> Showmanship </text>
        <br>
        <input id="showmanship-f"> </input>
        <br>
        <br>
        <button onclick="storeEval()"> Submit </button>
        <br>
        <br>
        <table style="width:100%" id="eval-final-table">
          <tr>
            <td style="width:20%"> Name </td>
            <td style="width:8%"> EXE </td>
            <td style="width:8%"> CTL </td>
            <td style="width:8%"> TDV </td>
            <td style="width:8%"> SEM </td>
            <td style="width:8%"> MU1 </td>
            <td style="width:8%"> MU2 </td>
            <td style="width:8%"> BDY </td>
            <td style="width:8%"> SHW </td>
            <td style="width:16%"> Edit Scores </td>
        </table>
      </div>
      <div id="finish-click">
        <button onclick="appendClick()"> Submit Final Scores </button>
      </div>
      <div id='eval-qualifying-input'>
        <text id="eval-player-name-qualifying">  </text>
        <br>
        <br>
        <text> Input Eval Score </text>
        <br>
        <br>
        <text> Execution </text>
        <br>
        <input id="execution-q"> </input>
        <br>
        <br>
        <text> Control </text>
        <br>
        <input id="control-q"> </input>
        <br>
        <br>
        <text> Choreography </text>
        <br>
        <input id="choreography-q"> </input>
        <br>
        <br>
        <text> Body Control </text>
        <br>
        <input id="body-control-q"> </input>
        <br>
        <br>
        <button onclick="storeEval()"> Submit </button>
        <br>
        <br>
        <table style="width:100%" id="eval-qualifying-table">
          <tr>
            <td style="width:40%"> Name </td>
            <td style="width:10%"> EXE </td>
            <td style="width:10%"> CTL </td>
            <td style="width:10%"> MU1 </td>
            <td style="width:10%"> BDY </td>
            <td style="width:20%"> Edit Scores </td>
        </table>
      </div>
      <div id="finish-eval">
        <button onclick="appendEval()"> Submit Final Scores </button>
      </div>
      <script src="headJudge.js"> </script>
      <script src="clickerJudge.js"> </script>
      <script src="evalJudge.js"> </script>
      <script src="compile.js"> </script>
    </body>
  </div>

  <script type="text/javascript">
  $(function() {
    $("#login").hide();
    $("#judge-1").hide();
    $("#judge-2").hide();
    $("#contest-info").hide();
    $("#player-info").hide();
    $("#click-input").hide();
    $("#eval-final-input").hide();
    $("#eval-qualifying-input").hide();
    $("#finish-eval").hide();
    $("#finish-click").hide();
    $("#eval-qualifying-table").hide();
    $("#eval-final-table").hide();
  });
  </script>

<script type="text/javascript">
  var spreadsheet = "";
  var contest_name = "";
  var div_name = "";
  var round = "";
  var clicker_judges = [];
  var eval_judges = [];
  var players = [];
  var index = 0;
  var positives = [];
  var negatives = [];
  var restarts = [];
  var discards = [];
  var detaches = [];
  var controlList = [];
  var executionList = [];
  var variationList = [];
  var spaceUseList = [];
  var bodyControlList = [];
  var choreographyList = [];
  var constructionList = [];
  var showmanshipList = [];
  var playerList = [];
  var judgename = "";
  var range = "";
  var techScores = [];
  var techevalScores = [];
  var perfevalScores = [];
  var oneJ = [];
  var twoJ = [];
  var threeJ = [];
  var fourJ = [];
  var fiveJ = [];
  var sixJ = [];
  var liveClicks = [];
  var liveEvals = [];
  var numPlayers = 0;
  var contests = [];
  var contests_list = [];
  var selectedDivision;
  var selectedJudgeType;
  var selectedContest;
  var selectedJudgeName;
  var roundType;


  function initClient() {
    var API_KEY = "AIzaSyBL78U6X04LeYMJ2h-35dPoPnXduUx_opo";  // TODO: Update placeholder with desired API key.
    var CLIENT_ID = "174011806378-ruu4bj26124mrbejev4btf1v4v8kslrb.apps.googleusercontent.com";  // TODO: Update placeholder with desired client ID.
    var SCOPE = "https://www.googleapis.com/auth/spreadsheets";

    gapi.client.init({
      "apiKey": API_KEY,
      "clientId": CLIENT_ID,
      "scope": SCOPE,
      "discoveryDocs": ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
    }).then(function() {
      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
      updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
    });

  }

  function createNew()
  {
    $('#login').hide();
    $('#contest-info').show();
  }

  function getContests()
  {
    //gets contests to select from
    gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: '1FCssxQv3_yPsPt6c-Poeicj_ODNH0ZJyCUI6gwxGFS4',
    range: "A1:C100"
    }).then((response) => {
    contests = response.result.values;
    for (i=0;i<contests.length;i++)
    {
      if (contests_list.includes(contests[i][0]) == false)
      {
        contests_list.push(contests[i][0]);
        var contest_select = document.getElementById("contest-selection");
        var option = document.createElement("option");
        option.text = contests[i][0];
        contest_select.add(option);
      }
      else
      {
        continue;
      }
    }
    }, function(reason) {
    console.error("error: " + reason.result.error.message);
    alert("Error.");
    });
  }

  function loadJudge()
  {
    var selectedContestDropdown = document.getElementById("contest-selection");
    selectedContest = selectedContestDropdown.options[selectedContestDropdown.selectedIndex].text;
    for (i=0;i<contests.length;i++)
    {
      if (contests[i][0] ==  selectedContest)
      {
      var div_select = document.getElementById("div-selection");
      var option = document.createElement("option");
      option.text = contests[i][1];
      div_select.add(option);
      }
      else
      {
        continue;
      }
    }
    $('#judge-1').show();
  }

  function chooseJudge()
  {
    $('#judge-2').show();
    var selectedContestDropdown = document.getElementById("contest-selection");
    selectedContest = selectedContestDropdown.options[selectedContestDropdown.selectedIndex].text;
    var selectedDivTypeDropdown = document.getElementById("div-selection");
    selectedDivision = selectedDivTypeDropdown.options[selectedDivTypeDropdown.selectedIndex].text;
    var selectedJudgeTypeDropdown = document.getElementById("judge-type");
    selectedJudgeType = selectedJudgeTypeDropdown.options[selectedJudgeTypeDropdown.selectedIndex].text;
    for (i=0;i<contests.length;i++)
    {
      if (contests[i][0] == selectedContest && contests[i][1] == selectedDivision)
      {
        if (selectedJudgeType == "Clicker")
        {
          spreadsheet = contests[i][2];
          var beginId = spreadsheet.indexOf("d/") + 2;
          var endId = spreadsheet.indexOf("/e");
          spreadsheetId = spreadsheet.slice(beginId, endId);
          gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: spreadsheetId,
          range: "SET-UP!F3:F8"
          }).then((response) => {
          clicker_judges = response.result.values.slice();
          for (var i=0;i<clicker_judges.length;i++)
          {
            var judge_list = document.getElementById("judge-list");
            var option = document.createElement("option");
            option.text = clicker_judges[i];
            judge_list.add(option);
          }
          }, function(reason) {
          console.error("error: " + reason.result.error.message);
          alert("Error.");
          });
        }
        else if (selectedJudgeType == "Evaluation")
        {
          spreadsheet = contests[i][2];
          var beginId = spreadsheet.indexOf("d/") + 2;
          var endId = spreadsheet.indexOf("/e");
          spreadsheetId = spreadsheet.slice(beginId, endId);
          gapi.client.sheets.spreadsheets.values.get({
          spreadsheetId: spreadsheetId,
          range: "SET-UP!F16:F21"
          }).then((response) => {
          eval_judges = response.result.values.slice();
          for (var i=0;i<eval_judges.length;i++)
          {
            var judge_list = document.getElementById("judge-list");
            var option = document.createElement("option");
            option.text = eval_judges[i];
            judge_list.add(option);
          }
          }, function(reason) {
          console.error("error: " + reason.result.error.message);
          alert("Error.");
          });
        }
      }
    }
  }

  function handleClientLoad() {
  gapi.load("client:auth2", initClient);
  }

  function updateSignInStatus(isSignedIn) {
    if (isSignedIn) {
      getContests();
      $("#login").show();
    }
  }

  function handleSignInClick(event) {
    gapi.auth2.getAuthInstance().signIn();
  }

  function handleSignOutClick(event) {
    gapi.auth2.getAuthInstance().signOut();
  }

  function startJudging() {
    $('#judge-1').hide();
    $('#judge-2').hide();
    $("#login").hide();
    retrievePlayers();
    if (selectedJudgeType == "Clicker")
    {
      processType(clicker_judges);
    }
    else if (selectedJudgeType == "Evaluation")
    {
      processType(eval_judges);
    }
  }

  function retrievePlayers() {
    // gets players from spreadsheet
    gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: spreadsheetId,
    range: "PLAYER!B4:B103"
    }).then((response) => {
    players = response.result.values;
    for (var i=0;i<players.length;i++)
    {
      playerList.push(players[i][0]);
    }
    numPlayers = players.length;
    if (selectedJudgeType == "Clicker")
    {
    loadClickTable(numPlayers);
    loadClickScores();
    $("#click-input").show();
    }
    else if (selectedJudgeType == "Evaluation")
    {
    loadEvalTable(numPlayers);
    loadEvalScores();
    }
    }, function(reason) {
    console.error("error: " + reason.result.error.message);
    alert("Error.");
    });
  }

  function processType(list) {
      var selectedJudgeDropdown = document.getElementById("judge-list");
      selectedJudgeName = selectedJudgeDropdown.options[selectedJudgeDropdown.selectedIndex].text;
      if (selectedJudgeType == "Clicker")
      {
        for (var i=0; i<list.length; i++)
        {
          if (list[i] == selectedJudgeName)
          {
            if (i == 0)
            {
              range = "RAW-TEx!F4:G104";
            }
            else if (i == 1)
            {
              range = "RAW-TEx!H4:I104";
            }
            else if (i == 2)
            {
              range = "RAW-TEx!J4:K104";
            }
            else if (i == 3)
            {
              range = "RAW-TEx!L4:M104";
            }
            else if (i == 4)
            {
              range = "RAW-TEx!N4:O104";
            }
            else if (i == 5)
            {
              range = "RAW-TEx!P4:Q104";
            }
          }
        }
      }
      else if (selectedJudgeType == "Evaluation" && $('#8').prop('checked'))
      {
        roundType = "final";
        for (var i=0; i<list.length; i++)
        {
          if (list[i] == selectedJudgeName)
          {
            if (i == 0)
            {
              range = "RAW-TEvPEv!C4:J104";
            }
            else if (i == 1)
            {
              range = "RAW-TEvPEv!K4:R104";
            }
            else if (i == 2)
            {
              range = "RAW-TEvPEv!S4:Z104";
            }
            else if (i == 3)
            {
              range = "RAW-TEvPEv!A4:AH104";
            }
            else if (i == 4)
            {
              range = "RAW-TEvPEv!AI4:AP104";
            }
            else if (i == 5)
            {
              range = "RAW-TEvPEv!AQ4:AX104";
            }
          }
        }
      }
      else if (selectedJudgeType == "Evaluation" && $('#4').prop('checked'))
      {
        roundType = "qualifying";
        for (var i=0; i<list.length; i++)
        {
          if (list[i] == selectedJudgeName)
          {
            if (i == 0)
            {
              range = "RAW-TEvPEv!C4:F104";
            }
            else if (i == 1)
            {
              range = "RAW-TEvPEv!G4:J104";
            }
            else if (i == 2)
            {
              range = "RAW-TEvPEv!K4:N104";
            }
            else if (i == 3)
            {
              range = "RAW-TEvPEv!04:R104";
            }
            else if (i == 4)
            {
              range = "RAW-TEvPEv!S4:V104";
            }
            else if (i == 5)
            {
              range = "RAW-TEvPEv!W4:Z104";
            }
          }
        }
      }
      $("#login").hide();
    }


</script>

<script async defer src="https://apis.google.com/js/api.js"
onload="this.onload=function(){};handleClientLoad()"
onreadystatechange="if (this.readyState === "complete") this.onload()">
</script>



</html>
