<html>
  <div id="head">
    <head style="text-align: center;">
      <h1> Contest Judging Entry </h1>
    </head>
  </div>

  <div id="body">
    <body style="text-align: center;">
      <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
      <button onclick="handleSignInClick()"> Press to sign in to verify access to Google Spreadsheets. </button>
      <br>
      <br>
      <div id='login'>
        <text> What is your judge position? </text>
        <br>
        <br>
        <select id="judge-selection">
        <option value="head">Head</option>
        <option value="clicker">Clicker</option>
        <option value="eval">Eval</option>
        </select>
        <br>
        <br>
        <text> What is your name? </text>
        <br>
        <br>
        <input id="judge-name"> </input>
        <br>
        <br>
        <text> What round are you judging? </text>
        <br>
        <br>
        <select id="round-selection">
        <option value="qualifying">Prelim/Semi-Final (4 evaluations)</option>
        <option value="final">Final (8 evaluations)</option>
        </select>
        <br>
        <br>
        <text> Input Spreadsheet Link Here </text>
        <br>
        <br>
        <input id="spreadsheet-id"> </input>
        <br>
        <br>
        <button onclick="getJudge()"> Submit </button>
      </div>
      <div id='contest-info'>
        <text> Input Contest Name </text>
        <br>
        <input id="contest-name"> </input>
        <br>
        <br>
        <text> Input Division Name </text>
        <br>
        <input id="div-name"> </input>
        <br>
        <br>
        <text> Input Clicker Judges </text>
        <br>
        <textarea id="clicker-judges"> </textarea>
        <br>
        <br>
        <text> Input Eval Judges </text>
        <br>
        <textarea id="eval-judges"> </textarea>
        <br>
        <br>
        <button onclick="enterInfo()"> Submit </button>
        <br>
        <br>
      </div>
      <div id='player-info'>
        <text> Input Player List </text>
        <br>
        <textarea id="player-list"> </textarea>
        <br>
        <br>
        <button onclick="enterPlayer()"> Submit </button>
      </div>
      <div id='click-input'>
        <text id="click-player-name">  </text>
        <br>
        <br>
        <text> Input Clicker Score </text>
        <br>
        <br>
        <text> Positive </text>
        <br>
        <input id="positive"> </input>
        <br>
        <br>
        <text> Negative </text>
        <br>
        <input id="negative"> </input>
        <br>
        <br>
        <text> Restart </text>
        <br>
        <input id="restart"> </input>
        <br>
        <br>
        <text> Discard </text>
        <br>
        <input id="discard"> </input>
        <br>
        <br>
        <text> Detach </text>
        <br>
        <input id="detach"> </input>
        <br>
        <br>
        <button onclick="storeClick()"> Submit </button>
        <br>
        <br>
        <table style="width:100%" id="click-table">
          <tr>
            <td> Name </td>
            <td> + </td>
            <td> - </td>
            <td> Restart </td>
            <td> Discard </td>
            <td> Detach </td>
            <td> Edit Scores </td>
        </table>
      </div>
      <div id='eval-input'>
        <text id="eval-player-name">  </text>
        <br>
        <br>
        <text> Input Eval Score </text>
        <br>
        <br>
        <text> Control </text>
        <br>
        <input id="control"> </input>
        <br>
        <br>
        <text> Execution </text>
        <br>
        <input id="execution"> </input>
        <br>
        <br>
        <text> Variation </text>
        <br>
        <input id="variation"> </input>
        <br>
        <br>
        <text> Choreography </text>
        <br>
        <input id="choreography"> </input>
        <br>
        <br>
        <text> Construction </text>
        <br>
        <input id="construction"> </input>
        <br>
        <br>
        <text> Space Use </text>
        <br>
        <input id="space-use"> </input>
        <br>
        <br>
        <text> Body Control </text>
        <br>
        <input id="body-control"> </input>
        <br>
        <br>
        <text> Showmanship </text>
        <br>
        <input id="showmanship"> </input>
        <br>
        <br>
        <button onclick="storeEval()"> Submit </button>
        <br>
        <br>
        <table style="width:100%" id="eval-table">
          <tr>
            <td> Name </td>
            <td> Control </td>
            <td> Execution </td>
            <td> Variation </td>
            <td> Space Use </td>
            <td> Body Control </td>
            <td> Showmanship </td>
            <td> Construction </td>
            <td> Choreography </td>
            <td> Edit Scores </td>
        </table>
      </div>
      <div id="results-chart">
      </div>
      <div id="texcomp-chart">
      </div>
      <div id="finish">
        <button onclick="window.location.reload()"> Go Home </button>
      </div>
      <script src="headJudge.js"> </script>
      <script src="clickerJudge.js"> </script>
      <script src="evalJudge.js"> </script>
      <script src="compile.js"> </script>
    </body>
  </div>

  <script type="text/javascript">
  $(function() {
    $("#login").hide();
    $("#contest-info").hide();
    $("#player-info").hide();
    $("#click-input").hide();
    $("#eval-input").hide();
    $("#results-chart").hide();
    $("#texcomp-chart").hide();
    $("#finish").hide();
  });
  </script>

<script type="text/javascript">
  var spreadsheet = "";
  var contest_name = "";
  var div_name = "";
  var round = "";
  var clicker_judges = [];
  var eval_judges = [];
  var players = [];
  var index = 0;
  var positives = [];
  var negatives = [];
  var restarts = [];
  var discards = [];
  var detaches = [];
  var controlList = [];
  var executionList = [];
  var variationList = [];
  var spaceUseList = [];
  var bodyControlList = [];
  var choreographyList = [];
  var constructionList = [];
  var showmanshipList = [];
  var playerList = [];
  var p1 = "";
  var judgename = "";
  var range = "";
  var techScores = [];
  var techevalScores = [];
  var perfevalScores = [];
  var techeval = 0;
  var perfeval = 0;
  var major = 0;
  var results_order = [];
  var tech_comp = [];
  var oneJ = [];
  var twoJ = [];
  var threeJ = [];
  var fourJ = [];
  var fiveJ = [];
  var sixJ = [];
  var liveClicks  = [];
  var liveEvals = [];
  var judgeType = "";
  var numPlayers = 0;
  var roundType = "";


  function initClient() {
    var API_KEY = "AIzaSyBL78U6X04LeYMJ2h-35dPoPnXduUx_opo";  // TODO: Update placeholder with desired API key.
    var CLIENT_ID = "174011806378-ruu4bj26124mrbejev4btf1v4v8kslrb.apps.googleusercontent.com";  // TODO: Update placeholder with desired client ID.
    var SCOPE = "https://www.googleapis.com/auth/spreadsheets";

    gapi.client.init({
      "apiKey": API_KEY,
      "clientId": CLIENT_ID,
      "scope": SCOPE,
      "discoveryDocs": ["https://sheets.googleapis.com/$discovery/rest?version=v4"],
    }).then(function() {
      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSignInStatus);
      updateSignInStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
    });

  }

  function handleClientLoad() {
  gapi.load("client:auth2", initClient);
  }

  function updateSignInStatus(isSignedIn) {
    if (isSignedIn) {
      $("#login").show();
    }
  }

  function handleSignInClick(event) {
    gapi.auth2.getAuthInstance().signIn();
  }

  function handleSignOutClick(event) {
    gapi.auth2.getAuthInstance().signOut();
  }

  function retrievePlayers() {
    gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: spreadsheetId,
    range: "PLAYER!B4:B103"
    }).then((response) => {
    players = response.result.values;
    for (x in players)
    {
      playerList.push(players[x][0]);
    }
    // loadClickTable(playerList.length);
    numPlayers = playerList.length;
    loadClickTable(numPlayers);
    loadEvalTable(playerList.length);
    $('#click-player-name').text(playerList[0]);
    $('#eval-player-name').text(playerList[0]);
    $('#positive').val('');
    $('#negative').val('');
    }, function(reason) {
    console.error("error: " + reason.result.error.message);
    alert("Error.");
    });
  }

  function getJudge() {
    spreadsheet = $('#spreadsheet-id').val();
    var beginId = spreadsheet.indexOf("d/") + 2;
    var endId = spreadsheet.indexOf("/e");
    spreadsheetId = spreadsheet.slice(beginId, endId);
    var judgeChoice = document.getElementById("judge-selection");
    judgename = $('#judge-name').val();
    judgeType = judgeChoice.options[judgeChoice.selectedIndex].value;
    if (judgeType == "head")
    {
    $("#login").hide();
    $('#contest-info').show();
    }
    else if (judgeType == "clicker")
    {
    gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: spreadsheetId,
    range: "SET-UP!F3:F8"
    }).then((response) => {
    clicker_judges = response.result.values;
    processType(clicker_judges, judgeType);
    }, function(reason) {
    console.error("error: " + reason.result.error.message);
    alert("Error.");
    });
    }
    else if (judgeType = "eval")
    {
    gapi.client.sheets.spreadsheets.values.get({
    spreadsheetId: spreadsheetId,
    range: "SET-UP!F16:F21"
    }).then((response) => {
    eval_judges = response.result.values;
    processType(eval_judges, judgeType);
    }, function(reason) {
    console.error("error: " + reason.result.error.message);
    alert("Error.");
    });
    }

  }

  function processType(list, type) {
    var judgeverified = false;
    retrievePlayers();
    var roundChoice = document.getElementById("round-selection");
    var roundType = judgeChoice.options[judgeChoice.selectedIndex].value;
    if (type == "clicker")
    {
      for (var i=0; i<list.length; i++)
      {
        if (list[i] == judgename)
        {
          if (i == 0)
          {
            range = "RAW-TEx!F4:G104";
          }
          else if (i == 1)
          {
            range = "RAW-TEx!H4:I104";
          }
          else if (i == 2)
          {
            range = "RAW-TEx!J4:K104";
          }
          else if (i == 3)
          {
            range = "RAW-TEx!L4:M104";
          }
          else if (i == 4)
          {
            range = "RAW-TEx!N4:O104";
          }
          else if (i == 5)
          {
            range = "RAW-TEx!P4:Q104";
          }
        }
      }
      for (var i=0; i<list.length; i++)
      {
        if (list[i][0] == judgename)
        {
          judgeverified = true;
        }
      }
      if (judgeverified == false)
      {
        alert("Name entered is not registered to judge this event.");
        window.location.reload();
      }
      else
      {
        $("#login").hide();
        $('#click-input').show();
      }
    }
    else if (type == "eval" && roundType == "final")
    {
      for (var i=0; i<list.length; i++)
      {
        if (list[i] == judgename)
        {
          if (i == 0)
          {
            range = "RAW-TEvPEv!C4:J104";
          }
          else if (i == 1)
          {
            range = "RAW-TEvPEv!K4:R104";
          }
          else if (i == 2)
          {
            range = "RAW-TEvPEv!S4:Z104";
          }
          else if (i == 3)
          {
            range = "RAW-TEvPEv!A4:AH104";
          }
          else if (i == 4)
          {
            range = "RAW-TEvPEv!AI4:AP104";
          }
          else if (i == 5)
          {
            range = "RAW-TEvPEv!AQ4:AX104";
          }
        }
      }
      for (var i=0; i<list.length; i++)
      {
        if (list[i][0] == judgename)
        {
          judgeverified = true;
        }
      }
      if (judgeverified == false)
      {
        alert("Name entered is not registered to judge this event.");
        window.location.reload();
      }
      else
      {
        $("#login").hide();
        $('#eval-input').show();
      }
    }
    else if (type == "eval" && roundType == "qualifying")
    {
      for (var i=0; i<list.length; i++)
      {
        if (list[i] == judgename)
        {
          if (i == 0)
          {
            range = "RAW-TEvPEv!C4:F104";
          }
          else if (i == 1)
          {
            range = "RAW-TEvPEv!G4:J104";
          }
          else if (i == 2)
          {
            range = "RAW-TEvPEv!K4:N104";
          }
          else if (i == 3)
          {
            range = "RAW-TEvPEv!O4:R104";
          }
          else if (i == 4)
          {
            range = "RAW-TEvPEv!S4:V104";
          }
          else if (i == 5)
          {
            range = "RAW-TEvPEv!W4:Z104";
          }
        }
      }
      for (var i=0; i<list.length; i++)
      {
        if (list[i][0] == judgename)
        {
          judgeverified = true;
        }
      }
      if (judgeverified == false)
      {
        alert("Name entered is not registered to judge this event.");
        window.location.reload();
      }
      else
      {
        $("#login").hide();
        $('#eval-input').show();
      }
    }
  }
</script>

<script async defer src="https://apis.google.com/js/api.js"
onload="this.onload=function(){};handleClientLoad()"
onreadystatechange="if (this.readyState === "complete") this.onload()">
</script>



</html>
